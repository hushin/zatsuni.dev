---
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "@components/Card.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { SITE } from "@config";
import Datetime from "@components/Datetime.astro";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<BaseLayout title={SITE.title} description={SITE.desc}>
  <div class="container mx-auto max-w-4xl px-4 py-8">
    <section id="hero" class="hero py-8">
      <div class="hero-content flex-col gap-8 lg:flex-row-reverse">
        <div class="avatar">
          <a href="/about/">
            <div class="w-24 rounded-full bg-[#FF7F00] p-2">
              <img
                src="/my-icon-min.svg"
                class="w-full rounded-full"
                alt="hush_in icon"
              />
            </div>
          </a>
        </div>
        <div class="text-center lg:text-left">
          <h1 class="text-base-content text-xl">雑に作る。雑記も書く。</h1>
          <p class="text-base-content/80 prose py-4">
            <LinkButton variant="link" href="/about/"> About me → </LinkButton>
          </p>
        </div>
      </div>
    </section>

    {
      featuredPosts.length > 0 && (
        <>
          <section id="featured" class="py-8">
            <h2 class="text-base-content mb-6 text-2xl font-bold">
              人気の記事
            </h2>
            <ul class="space-y-4">
              {featuredPosts.map(({ data, id }) => (
                <Card href={`/posts/${id}/`} frontmatter={data} />
              ))}
            </ul>
          </section>
        </>
      )
    }

    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="py-8">
          <h2 class="text-base-content mb-6 text-2xl font-bold">最新記事</h2>
          <ul class="space-y-4">
            {recentPosts.map(
              ({ data, id }, index) =>
                index < SITE.postPerIndex && (
                  <Card href={`/posts/${id}/`} frontmatter={data} />
                )
            )}
          </ul>
        </section>
      )
    }

    <div class="flex justify-center pb-12">
      <LinkButton href="/posts/" variant="ghost" size="lg" className="gap-2">
        すべての記事
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
        </svg>
      </LinkButton>
    </div>

    <section id="slide" class="py-8">
      <h2 class="text-base-content mb-6 text-2xl font-bold">登壇資料</h2>
      <ul class="space-y-6">
        <li class="card bg-base-100 border-base-300 border">
          <div class="card-body p-6">
            <a
              href="https://hushin.github.io/slides/figma-cloudflare-hono.html"
              class="group"
              target="_blank"
              rel="noopener noreferrer"
            >
              <h3
                class="card-title group-hover:text-primary text-lg font-semibold transition-colors"
              >
                Figma API + Cloudflare + Hono で画像共有
                <svg
                  class="h-4 w-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                  ></path>
                </svg>
              </h3>
            </a>
            <Datetime pubDatetime="2024-01-12" modDatetime={null} size="sm" />
            <p class="text-base-content/80 mt-2">
              <a
                href="https://kyotojs.connpass.com/event/302442/"
                class="link link-primary"
                target="_blank"
                rel="noopener noreferrer"
              >
                ToKyoto.js #02
              </a> で登壇
            </p>
          </div>
        </li>
      </ul>
    </section>
  </div>
</BaseLayout>
